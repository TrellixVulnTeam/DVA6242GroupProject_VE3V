<!DOCTYPE html>
<html>
<head>
  <title>Simple Map</title>
  <meta name="viewport" content="initial-scale=1.0">
  <meta charset="utf-8">
  <script src="apartments.js"></script>
  <script src="details.js"></script>
  <script src="googlemap_apt_function.js"></script>
  <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>

<div id="map">
  <script>
      var markers = [];
      var infowindows = [];
      var restaurants = [];
      var names = [];
      var image_urls =[];
      var urls = [];
      var ratings = [];
      var prices = [];
      var display_phones = [];
      var yelp_coordinates = [];


      for (i = 0; i < yelp.length; i++) { 
          var lat = yelp[i]['coordinates']['latitude'];
          var lng = yelp[i]['coordinates']['longitude'];
          var rest = {};
          rest['lat'] = lat;
          rest['lng'] = lng;
          yelp_coordinates.push(rest);
          names.push(yelp[i]['name']);
          image_urls.push(yelp[i]['image_url']);
          urls.push(yelp[i]['url']);
          ratings.push(yelp[i]['rating']);
          if (typeof yelp[i]['price'] === 'undefined'){
            prices.push('NA');
          } else { 
            prices.push(yelp[i]['price']);
          }
          display_phones.push(yelp[i]['display_phone'])
      }
       console.log(yelp_coordinates)

      var map;
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: apt,
          zoom: 15
        });

        var styles = {
            default: null,
            hide: [
              {
                featureType: 'poi',
                stylers: [{visibility: 'off'}]
              },
              {
                featureType: 'transit',
                elementType: 'labels.icon',
                stylers: [{visibility: 'off'}]
              }
            ]
        };

        map.setOptions({styles: styles['hide']});




        var yelp_time_transits = getTimesTransit(yelp_coordinates,map);
        var yelp_time_walks = getTimesWalk(yelp_coordinates,map);

        var yelp_strings=[];


        Promise.all(yelp_time_transits)     
        .then(function(yelp_time_transits){
          Promise.all(yelp_time_walks)     
          .then(function(yelp_time_walks){
            for(i=0; i<yelp.length;i++){
              var string ='<div id="iw-container">' +
                            '<div class="iw-subTitle">'+names[i]+'</div>' +
                            '<div class="iw-content">' +
                              // '<div class="iw-subTitle">' + ratings[i] +'</div>' +
                              '<img src='+image_urls[i] +' height="120">' + '<br>'+
                                // '<p>LLLL</p>' +
                              // '<div class="iw-subTitle">Details</div>' +
                                '<p> Rating: ' + ratings[i] +
                                '<br>Phone: ' + display_phones[i] +
                                '<br>Price: ' + prices[i] +
                                '<br>Transit time: ' + yelp_time_transits[i] +
                                '<br>Walk time: ' + yelp_time_walks[i] +

                                // '<br>Yelp link: ' + urls[i] + '</p>'+
                                '<br><a target="_blank" href=' + urls[i] + '>Click here to open this in Yelp</a>' + '</p>'+
                              '</div>' +
                              '<div class="iw-bottom-gradient"></div>' +
                            '</div>';
              yelp_strings.push(string);
            }

              var marker = new google.maps.Marker({
                position: apt,
                map: map,
                title: 'apartment',
                icon: 'marker_house_pink.png'
              });

              for (i = 0; i < yelp_coordinates.length; i++) { 
                addMarker(yelp_coordinates[i], map, yelp_strings[i])
                 
              }

        })
        })
      }



  </script>
</div>

<div id='markers_info'>
  <script>

  </script>
</div>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAwrdvLk2XruYEsLwqpYwiqnaKbSwhHiiM&callback=initMap"
    async defer></script>
  </body>
</html>
